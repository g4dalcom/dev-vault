# 프로젝트 설명과 역할

- 돌고돌래는 국내 여행지 추천 서비스입니다. 모바일 first UI로 개발을 하였고 여행지 정보는 한국관광공사 OPEN API를 이용하였습니다.
- 주요 기능으로는
	1. 카테고리별 인기있는 여행지
	2. 카테고리와 지역으로 필터링
	3. 여행지 이름으로 검색
	4. 여행지에 대한 리뷰를 댓글 형식으로 남길 수 있는 기능
	5. 랜덤 여행지 추천과 여행지 월드컵이라는 미니게임입니다.
- 여기서 제가 맡은 역할은 여행지에 대한 리뷰 관련 기능과 여행지 이름으로 검색할 수 있는 기능이었습니다.


# 이미지 다중 업로드 기능

- 기본적인 구조는 사용자가 리뷰에 이미지를 업로드하면 해당 이미지 파일들을 리스트로 받아서 고유한 이름으로 난수 생성한 뒤에 바이트로 바꾸어서 S3에 업로드하였고 S3에 업로드한 파일의 URL을 데이터베이스에 저장하는 식으로 구현하였습니다.
- 이 기능을 구현할 때 고민이 되었던 부분은, 사용자가 등록한 이미지 파일을 multipartfile로 받게 되는데 하나의 파일만을 업로드할 때는 단일 multipartfile로 받고 다중 파일을 업로드 할 때는 리스트로 받는데 이것을 매개변수를 달리한 오버로딩을 적용할 것인지 아니면 모두 리스트로 받을 것인지였는데요.
- 하나의 파일을 리스트로 받는다고 해도 성능상 영향이 없고 오히려 구현 과정에서 불필요하게 중복 메소드가 생긴다던가, 프론트엔드에서도 파일이 단일인지 다중인지를 체크해서 request를 구분해야 하는 등 여러 복잡성 때문에 오버로딩을 적용하지 않았습니다.
- 또한 리뷰를 수정할 때 이미지 처리 문제도 있었는데요.
- 사용자가 이미지를 등록하면 등록한 이미지의 미리보기를 보여주고 X표시를 눌러서 삭제할 수 있도록 프론트에서 구현이 되어있었는데, 리뷰를 수정할 때 만약 기존에 데이터베이스에 반영이 되어있던 이미지를 X표시 눌렀느냐, 새롭게 등록해서 아직 데이터베이스에 반영되지 않은 이미지를 X표시를 눌러서 삭제를 했느냐에 따라 처리를 달리 해야 했습니다.
- 만약 사용자가 기존에 등록했던 이미지를 X표시 했다면 데이터베이스와 S3 버킷에서도 삭제를 시켜주어야 했기 때문입니다.
- 당시에는 수정 작업 관련 API 메소드가 PUT으로 되어있어서 우선 데이터베이스와 S3에서 이미지를 일괄 삭제한 후 재등록하는 방식으로 구현하였는데 지금 생각해보면 사용자가 기존에 등록했던 이미지 중 삭제하지 않은 데이터는 굳이 데이터베이스와 S3에서 건드릴 필요가 없기 때문에 PATCH 메소드를 이용해서 수정된 사항만 반영되도록 구현할 것 같습니다.

# 여행지 검색 기능

- 그리고 또 한 가지는 여행지 검색 기능이었는데요.
- 단순히 여행지 이름으로 검색하는 기능이라면 JPA나 JPQL로 쿼리를 직접 작성해서 구현하는 것도 가능했겠지만 여행지의 개수가 3만 여개로 비교적 데이터가 많은 양이 아니고 데이터베이스상 여행지 이름의 띄어쓰기나 구조가 일관적이지 않았습니다.
- 검색되었어야 하는 키워드가 검색이 되지 않는 일을 줄이기 위해서는 검색어와 검색될 데이터들의 띄어쓰기와 같은 구조가 일관되어야 한다고 생각을 했고 이것을 좀 더 쉽게 구현하기 위해 Querydsl 을 이용해서 검색어와 데이터의 공백을 없애는 방식으로 구현하였습니다.